# Go Blog API

**Профессиональный API для блога**

[![Go Version](https://img.shields.io/badge/Go-1.24.9-blue.svg)](https://go.dev)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)
[![Standard Library](https://img.shields.io/badge/Dependencies-Standard%20Library-only-brightgreen)](https://pkg.go.dev/std)
[![Code Quality](https://img.shields.io/badge/Code%20Review-Passed-brightgreen)](https://github.com/kavlan-dev/golang-blog-web)

Высокопроизводительный API для блога, готовый к производственному использованию. Разработан с использованием чистой стандартной библиотеки Go. Ориентирован на масштабируемость, надежность и простоту интеграции.

---

## Архитектурные особенности

### Чистая архитектура
- **Модели**: Определение структур данных и бизнес-правил
- **Сервисы**: Бизнес-логика и координация между компонентами
- **Хранилище**: Абстракция доступа к данным (в памяти)
- **Обработчики**: HTTP-маршрутизация и обработка запросов
- **Middleware**: Переиспользуемые компоненты для аутентификации, CORS и т.д.

### Преимущества подхода
- **Легкость тестирования** - Каждый слой может быть протестирован независимо
- **Гибкость** - Легко заменить хранилище (например, на базу данных)
- **Масштабируемость** - Четкое разделение ответственности
- **Поддерживаемость** - Легко находить и исправлять ошибки

---

## Быстрый старт

### Требования
- Go 1.25
- Нет внешних зависимостей

### Установка
```bash
git clone https://github.com/kavlan-dev/golang-blog-web.git
cd golang-blog-web
```

### Запуск сервера
```bash
go run main.go
```

API будет доступен по адресу: `http://localhost:8080`

---

## Возможности

### Основной функционал
- **CRUD операции** - Полный набор операций создания, чтения, обновления и удаления записей блога
- **Валидация данных** - Комплексная проверка входных данных
- **Хранение в памяти** - Высокопроизводительное хранилище на основе памяти
- **RESTful дизайн** - Стандартизированные API-эндпоинты
- **JSON API** - Чистый формат JSON для запросов и ответов
- **Поддержка CORS** - Включена поддержка междоменных запросов
- **Аутентификация** - Базовая аутентификация для защищенных маршрутов
- **Ролевая модель** - Поддержка ролей пользователей (admin/user)

### Готовность к производству
- **Потокобезопасность** - Защита от конкурентного доступа
- **Обработка ошибок** - Комплексное управление ошибками
- **Конфигурируемость** - Настройка через переменные окружения
- **Без внешних зависимостей** - Используется только стандартная библиотека
- **Структурированное логирование** - JSON-логирование для легкого парсинга
- **Здоровье сервера** - Эндпоинт `/health/` для мониторинга

---

## Конфигурация

### Конфигурация

Проект поддерживает конфигурацию через переменные окружения. Все переменные имеют значения по умолчанию, но их можно переопределить для настройки поведения приложения.

#### Переменные окружения

| Переменная            | Описание                                                               | Значение по умолчанию       |
|-----------------------|------------------------------------------------------------------------|-----------------------------|
| `ENV`                 | Режим работы приложения (`dev` или `prod`)                             | `prod`                      |
| `ADMIN_USERNAME`      | Имя пользователя администратора                                        | `admin`                     |
| `ADMIN_PASSWORD`      | Пароль администратора                                                  | `admin`                     |
| `ADMIN_EMAIL`         | Email администратора                                                   | `admin@example.com`         |
| `SERVER_HOST`         | Хост, на котором запускается сервер                                    | `localhost`                 |
| `SERVER_PORT`         | Порт, на котором запускается сервер                                    | `8080`                      |
| `CORS_ALLOWED_ORIGIN` | Разрешенные источники для CORS (через запятую)                         | `localhost:5500, 127.0.0.1:8081` |

#### Настройка через файл `.env`

Файл `.env` используется для контейнеризации. При запуске проекта через `go run` или бинарник переменные окружения нужно экспортировать вручную.

Пример файла `.env`:
```env
ENV=dev
ADMIN_USERNAME=admin
ADMIN_PASSWORD=securepassword
ADMIN_EMAIL=admin@example.com
SERVER_HOST=0.0.0.0
SERVER_PORT=8080
CORS_ALLOWED_ORIGIN="localhost:5500, 127.0.0.1:8081"
```

#### Настройка вручную

Для запуска через `go run` или бинарник экспортируйте переменные окружения перед запуском:

```bash
export ENV=dev
export ADMIN_USERNAME=admin
export ADMIN_PASSWORD=securepassword
export ADMIN_EMAIL=admin@example.com
export SERVER_HOST=0.0.0.0
export SERVER_PORT=8080
export CORS_ALLOWED_ORIGIN="localhost:5500, 127.0.0.1:8081"

go run main.go
```

#### Примечания
- В режиме `dev` включены дополнительные логи и отладочная информация
- В режиме `prod` приложение работает в оптимизированном режиме
- Для безопасности рекомендуется изменить значения по умолчанию для `ADMIN_PASSWORD` в продакшене

---

## Документация API

### Эндпоинты

#### **GET** `/health` - Проверка здоровья сервера
**Ответ:**
```json
{
  "status": "healthy",
  "timestamp": "2024-01-17T14:33:00Z"
}
```

**Коды состояния:**
- `200 OK` - Сервер работает нормально

---

#### **POST** `/api/auth/register` - Регистрация пользователя
**Запрос:**
```json
{
  "username": "новый_пользователь",
  "password": "безопасный_пароль",
  "email": "user@example.com"
}
```

**Ответ:**
```json
{
  "id": 1,
  "username": "новый_пользователь",
  "email": "user@example.com",
  "role": "user"
}
```

**Коды состояния:**
- `201 Created` - Успешная регистрация
- `400 Bad Request` - Некорректные данные
- `405 Method Not Allowed` - Неправильный HTTP метод

---

#### **POST** `/api/posts` - Создание записи (требует аутентификации)
**Запрос:**
```json
{
  "title": "Заголовок записи",
  "content": "Содержимое записи"
}
```

**Ответ:**
```json
{
  "id": 1,
  "title": "Заголовок записи",
  "content": "Содержимое записи",
  "created_at": "2026-01-17T14:33:00Z",
  "updated_at": "2026-01-17T14:33:00Z"
}
```

**Коды состояния:**
- `201 Created` - Успех
- `400 Bad Request` - Некорректные данные
- `401 Unauthorized` - Требуется аутентификация
- `405 Method Not Allowed` - Неправильный HTTP метод

---

#### **GET** `/api/posts` - Получение всех записей
**Ответ:**
```json
[
  {
    "id": 1,
    "title": "Первая запись",
    "content": "Содержимое первой записи",
    "created_at": "2026-01-17T14:33:00Z",
    "updated_at": "2026-01-17T14:33:00Z"
  }
]
```

**Коды состояния:**
- `200 OK` - Успех
- `405 Method Not Allowed` - Неправильный HTTP метод

---

#### **GET** `/api/posts/{id}` - Получение одной записи по id
**Ответ:**
```json
{
  "id": 1,
  "title": "Первая запись",
  "content": "Содержимое первой записи",
  "created_at": "2026-01-17T14:33:00Z",
  "updated_at": "2026-01-17T14:33:00Z"
}
```

#### **GET** `/api/posts/title{title}` - Получение одной записи по заголовку
**Ответ:**
```json
{
  "id": 1,
  "title": "Первая запись",
  "content": "Содержимое первой записи",
  "created_at": "2026-01-17T14:33:00Z",
  "updated_at": "2026-01-17T14:33:00Z"
}
```

**Коды состояния:**
- `200 OK` - Успех
- `400 Bad Request` - Некорректный ID
- `404 Not Found` - Запись не найдена
- `405 Method Not Allowed` - Неправильный HTTP метод

---

#### **PUT** `/api/posts/{id}/` - Обновление записи (только для администраторов)
**Запрос:**
```json
{
  "title": "Обновленный заголовок",
  "content": "Обновленное содержимое"
}
```

**Ответ:**
```json
{
  "id": 1,
  "title": "Обновленный заголовок",
  "content": "Обновленное содержимое",
  "created_at": "2026-01-17T14:33:00Z",
  "updated_at": "2026-01-17T14:33:05Z"
}
```

**Коды состояния:**
- `200 OK` - Успех
- `400 Bad Request` - Некорректные данные или ID
- `401 Unauthorized` - Требуется аутентификация
- `403 Forbidden` - Недостаточно прав
- `404 Not Found` - Запись не найдена
- `405 Method Not Allowed` - Неправильный HTTP метод

---

#### **DELETE** `/api/posts/{id}/` - Удаление записи (только для администраторов)
**Коды состояния:**
- `204 No Content` - Успех
- `400 Bad Request` - Некорректный ID
- `401 Unauthorized` - Требуется аутентификация
- `403 Forbidden` - Недостаточно прав
- `404 Not Found` - Запись не найдена
- `405 Method Not Allowed` - Неправильный HTTP метод

---

#### **PUT** `/api/users/{id}/` - Обновление роли пользователя (только для администраторов)
**Запрос:**
```json
{
  "role": "admin"
}
```

**Ответ:**
```json
{
  "id": 1,
  "username": "пользователь",
  "email": "user@example.com",
  "role": "admin"
}
```

**Коды состояния:**
- `200 OK` - Успех
- `400 Bad Request` - Некорректный ID
- `401 Unauthorized` - Требуется аутентификация
- `403 Forbidden` - Недостаточно прав
- `404 Not Found` - Пользователь не найден
- `405 Method Not Allowed` - Неправильный HTTP метод

---

## Правила валидации

### Валидация записей
- **Заголовок**: Обязательное поле, должно быть уникальным (без учета регистра)
- **Содержимое**: Обязательное поле
- **Длина**: Заголовок и содержимое должны быть не пустыми после обрезки пробелов

### Валидация пользователей
- **Имя пользователя**: Обязательное поле
- **Пароль**: Обязательное поле (рекомендуется не менее 8 символов)
- **Email**: Обязательное поле, должен быть валидным email адресом

### Ответы об ошибках
```json
{
  "error": "Текст сообщения об ошибке"
}
```

---

## Структура проекта

```
golang-blog-web/
├── go.mod                  # Определение модуля Go
├── main.go                 # Точка входа в приложение
├── README.md               # Документация проекта
├── LICENSE                 # Лицензия MIT
├── .env.example            # Пример файла конфигурации окружения
├── Dockerfile              # Конфигурация Docker-образа
├── docker-compose.yml      # Конфигурация Docker Compose
└── internal/
    ├── config/             # Управление конфигурацией
    │   └── config.go       # Загрузка и обработка конфигурации
    ├── models/             # Модели данных
    │   ├── post.go         # Модель поста с валидацией
    │   └── user.go         # Модель пользователя с валидацией
    ├── services/           # Бизнес-логика
    │   ├── services.go     # Основные сервисы
    │   ├── post.go         # Логика работы с постами
    │   └── user.go         # Логика работы с пользователями
    ├── handlers/           # HTTP обработчики
    │   ├── handlers.go     # Основные обработчики
    │   ├── post.go         # Обработчики для постов
    │   └── user.go         # Обработчики для пользователей
    ├── middleware/         # HTTP middleware
    │   ├── auth.go         # Аутентификация
    │   ├── cors.go         # CORS поддержка
    │   └── role.go         # Проверка ролей
    ├── storage/            # Хранилище данных
    │   └── memory/         # Хранилище в памяти
    │       ├── memory.go   # Основное хранилище
    │       ├── post.go     # Хранение постов
    │       └── user.go     # Хранение пользователей
    └── utils/              # Утилиты
        ├── hash.go         # Хеширование паролей
        └── logger.go       # Структурированное логирование
```

---

## Тестирование

### Ручное тестирование с cURL

**Проверка здоровья сервера**
```bash
curl http://localhost:8080/health
```

**Регистрация пользователя**
```bash
curl -X POST http://localhost:8080/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","password":"testpass","email":"test@example.com"}'
```

**Создание записи (с аутентификацией)**
```bash
curl -X POST http://localhost:8080/api/posts \
  -H "Content-Type: application/json" \
  -u admin:admin \
  -d '{"title":"Тестовая запись","content":"Это тестовая запись"}'
```

**Получение всех записей**
```bash
curl http://localhost:8080/api/posts
```

**Получение одной записи**
```bash
curl http://localhost:8080/api/posts/1
```

**Обновление записи (только для администраторов)**
```bash
curl -X PUT http://localhost:8080/api/posts/1/ \
  -H "Content-Type: application/json" \
  -u admin:admin \
  -d '{"title":"Обновленная запись","content":"Обновленное содержимое"}'
```

**Удаление записи (только для администраторов)**
```bash
curl -X DELETE http://localhost:8080/api/posts/1/ \
  -u admin:admin
```

**Обновление роли пользователя (только для администраторов)**
```bash
curl -X PUT http://localhost:8080/api/users/1/ \
  -H "Content-Type: application/json" \
  -u admin:admin \
  -d '{"role":"admin"}'
```

---

## Аутентификация и безопасность

### Настройка базовой аутентификации

API поддерживает базовую аутентификацию. При запуске приложения создается администратор с данными для входа указанными в конфигурационном файле. Эндпоинт `/api/auth/register/` позволяет создать нового пользователя без прав администратора. для повышения прав воспользуйтесь эндпоинтом `/api/users/{id}`

## Лицензия

Этот проект лицензирован по **лицензии MIT** - см. файл [LICENSE](LICENSE) для деталей.
